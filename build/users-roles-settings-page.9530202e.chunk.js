(self.webpackChunkdb_busmerah=self.webpackChunkdb_busmerah||[]).push([[8853],{62031:(A,j,c)=>{"use strict";A.exports=c(59525)},59525:function(A,j,c){(function(n,x){A.exports=x(c(67294),c(78384))})(this,function(n,x){return function(s){var u={};function o(a){if(u[a])return u[a].exports;var i=u[a]={i:a,l:!1,exports:{}};return s[a].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=s,o.c=u,o.d=function(a,i,m){o.o(a,i)||Object.defineProperty(a,i,{enumerable:!0,get:m})},o.r=function(a){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o.t=function(a,i){if(1&i&&(a=o(a)),8&i||4&i&&typeof a=="object"&&a&&a.__esModule)return a;var m=Object.create(null);if(o.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:a}),2&i&&typeof a!="string")for(var p in a)o.d(m,p,function(O){return a[O]}.bind(null,p));return m},o.n=function(a){var i=a&&a.__esModule?function(){return a.default}:function(){return a};return o.d(i,"a",i),i},o.o=function(a,i){return Object.prototype.hasOwnProperty.call(a,i)},o.p="",o(o.s=110)}({0:function(s,u,o){s.exports=o(19)()},1:function(s,u){s.exports=n},10:function(s,u,o){var a=o(25),i=o(26),m=o(22),p=o(27);s.exports=function(O,h){return a(O)||i(O,h)||m(O,h)||p()},s.exports.default=s.exports,s.exports.__esModule=!0},110:function(s,u,o){"use strict";o.r(u),o.d(u,"Main",function(){return l}),o.d(u,"SkipToContent",function(){return X});var a,i=o(5),m=o.n(i),p=o(4),O=o.n(p),h=o(3),C=o.n(h),L=o(1),B=o.n(L),v=o(0),S=o.n(v),_=o(2),M=o.n(_),G=["labelledBy"],k=M.a.main(a||(a=C()([`
  // To prevent global outline on focus visible to force an outline when Main is focused
  &:focus-visible {
    outline: none;
  }
`]))),l=function(H){var q=H.labelledBy,oe=O()(H,G),se=q||"main-content-title";return B.a.createElement(k,m()({"aria-labelledby":se,id:"main-content",tabIndex:-1},oe))};l.defaultProps={labelledBy:void 0},l.propTypes={labelledBy:S.a.string};var f,T=o(6),Q=M()(T.Box)(f||(f=C()([`
  text-decoration: none;
  position: absolute;
  z-index: 9999;
  left: -100%;
  top: -100%;

  &:focus {
    left: `,`;
    top: `,`;
  }
`])),function(H){return H.theme.spaces[3]},function(H){return H.theme.spaces[3]}),X=function(H){var q=H.children;return B.a.createElement(Q,{as:"a",href:"#main-content",background:"primary600",color:"neutral0",padding:3,hasRadius:!0},q)};X.propTypes={children:S.a.node.isRequired}},13:function(s,u){function o(a){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?(s.exports=o=function(i){return typeof i},s.exports.default=s.exports,s.exports.__esModule=!0):(s.exports=o=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},s.exports.default=s.exports,s.exports.__esModule=!0),o(a)}s.exports=o,s.exports.default=s.exports,s.exports.__esModule=!0},19:function(s,u,o){"use strict";var a=o(20);function i(){}function m(){}m.resetWarningCache=i,s.exports=function(){function p(C,L,B,v,S,_){if(_!==a){var M=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw M.name="Invariant Violation",M}}function O(){return p}p.isRequired=p;var h={array:p,bool:p,func:p,number:p,object:p,string:p,symbol:p,any:p,arrayOf:O,element:p,elementType:p,instanceOf:O,node:p,objectOf:O,oneOf:O,oneOfType:O,shape:O,exact:O,checkPropTypes:m,resetWarningCache:i};return h.PropTypes=h,h}},2:function(s,u){s.exports=x},20:function(s,u,o){"use strict";s.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},21:function(s,u){s.exports=function(o,a){(a==null||a>o.length)&&(a=o.length);for(var i=0,m=new Array(a);i<a;i++)m[i]=o[i];return m},s.exports.default=s.exports,s.exports.__esModule=!0},22:function(s,u,o){var a=o(21);s.exports=function(i,m){if(i){if(typeof i=="string")return a(i,m);var p=Object.prototype.toString.call(i).slice(8,-1);return p==="Object"&&i.constructor&&(p=i.constructor.name),p==="Map"||p==="Set"?Array.from(i):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?a(i,m):void 0}},s.exports.default=s.exports,s.exports.__esModule=!0},24:function(s,u){s.exports=function(o,a){if(o==null)return{};var i,m,p={},O=Object.keys(o);for(m=0;m<O.length;m++)i=O[m],a.indexOf(i)>=0||(p[i]=o[i]);return p},s.exports.default=s.exports,s.exports.__esModule=!0},25:function(s,u){s.exports=function(o){if(Array.isArray(o))return o},s.exports.default=s.exports,s.exports.__esModule=!0},26:function(s,u){s.exports=function(o,a){var i=o==null?null:typeof Symbol!="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(i!=null){var m,p,O=[],h=!0,C=!1;try{for(i=i.call(o);!(h=(m=i.next()).done)&&(O.push(m.value),!a||O.length!==a);h=!0);}catch(L){C=!0,p=L}finally{try{h||i.return==null||i.return()}finally{if(C)throw p}}return O}},s.exports.default=s.exports,s.exports.__esModule=!0},27:function(s,u){s.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},s.exports.default=s.exports,s.exports.__esModule=!0},3:function(s,u){s.exports=function(o,a){return a||(a=o.slice(0)),Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(a)}}))},s.exports.default=s.exports,s.exports.__esModule=!0},4:function(s,u,o){var a=o(24);s.exports=function(i,m){if(i==null)return{};var p,O,h=a(i,m);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(i);for(O=0;O<C.length;O++)p=C[O],m.indexOf(p)>=0||Object.prototype.propertyIsEnumerable.call(i,p)&&(h[p]=i[p])}return h},s.exports.default=s.exports,s.exports.__esModule=!0},5:function(s,u){function o(){return s.exports=o=Object.assign||function(a){for(var i=1;i<arguments.length;i++){var m=arguments[i];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(a[p]=m[p])}return a},s.exports.default=s.exports,s.exports.__esModule=!0,o.apply(this,arguments)}s.exports=o,s.exports.default=s.exports,s.exports.__esModule=!0},6:function(s,u,o){"use strict";o.r(u),o.d(u,"Box",function(){return k});var a,i=o(3),m=o.n(i),p=o(2),O=o.n(p),h=o(7),C=o(1),L=o.n(C),B=o(0),v=o.n(B),S=function(l){return L.a.createElement("div",l)},_={background:void 0,borderColor:void 0,color:void 0,hiddenS:!1,hiddenXS:!1,padding:void 0,paddingTop:void 0,paddingRight:void 0,paddingBottom:void 0,paddingLeft:void 0,hasRadius:!1,shadow:void 0,children:null,shrink:void 0,grow:void 0,basis:void 0,flex:void 0,_hover:function(){}},M={_hover:v.a.func,background:v.a.string,basis:v.a.oneOfType([v.a.string,v.a.string]),borderColor:v.a.string,children:v.a.oneOfType([v.a.node,v.a.string]),color:v.a.string,flex:v.a.oneOfType([v.a.string,v.a.string]),grow:v.a.oneOfType([v.a.string,v.a.string]),hasRadius:v.a.bool,hiddenS:v.a.bool,hiddenXS:v.a.bool,padding:v.a.oneOfType([v.a.number,v.a.arrayOf(v.a.number)]),paddingBottom:v.a.oneOfType([v.a.number,v.a.arrayOf(v.a.number)]),paddingLeft:v.a.oneOfType([v.a.number,v.a.arrayOf(v.a.number)]),paddingRight:v.a.oneOfType([v.a.number,v.a.arrayOf(v.a.number)]),paddingTop:v.a.oneOfType([v.a.number,v.a.arrayOf(v.a.number)]),shadow:v.a.string,shrink:v.a.oneOfType([v.a.string,v.a.string])};S.defaultProps=_,S.propTypes=M;var G={color:!0},k=O.a.div.withConfig({shouldForwardProp:function(l,f){return!G[l]&&f(l)}})(a||(a=m()([`
  // Font
  font-size: `,`;

  // Colors
  background: `,`;
  color: `,`;

  // Spaces
  `,`
  `,`
  `,`
  `,`
  `,`
  `,`
  `,`
  `,`
  `,`

  // Responsive hiding
  `,`
  `,`
  

  // Borders
  border-radius: `,`;
  border-style: `,`;
  border-width: `,`;
  border-color: `,`;
  border: `,`;

  // Shadows
  box-shadow: `,`;

  // Handlers
  pointer-events: `,`;
  &:hover {
    `,`
  }

  // Display
  display: `,`;

  // Position
  position: `,`;
  left: `,`;
  right: `,`;
  top: `,`;
  bottom: `,`;
  z-index: `,`;
  overflow: `,`;
  cursor: `,`;

  // Size
  width: `,`;
  max-width: `,`;
  min-width: `,`;
  height: `,`;
  max-height: `,`;
  min-height: `,`;

  // Animation
  transition: `,`;
  transform: `,`;
  animation: `,`;

  //Flexbox children props
  flex-shrink: `,`;
  flex-grow: `,`;
  flex-basis: `,`;
  flex: `,`;

  // Text
  text-align: `,`;
  text-transform: `,`;
  line-height: `,`;

  // Cursor
  cursor: `,`;
`])),function(l){var f=l.fontSize;return l.theme.fontSizes[f]||f},function(l){var f=l.theme,T=l.background;return f.colors[T]},function(l){var f=l.theme,T=l.color;return f.colors[T]},function(l){var f=l.theme,T=l.padding;return Object(h.a)("padding",T,f)},function(l){var f=l.theme,T=l.paddingTop;return Object(h.a)("padding-top",T,f)},function(l){var f=l.theme,T=l.paddingRight;return Object(h.a)("padding-right",T,f)},function(l){var f=l.theme,T=l.paddingBottom;return Object(h.a)("padding-bottom",T,f)},function(l){var f=l.theme,T=l.paddingLeft;return Object(h.a)("padding-left",T,f)},function(l){var f=l.theme,T=l.marginLeft;return Object(h.a)("margin-left",T,f)},function(l){var f=l.theme,T=l.marginRight;return Object(h.a)("margin-right",T,f)},function(l){var f=l.theme,T=l.marginTop;return Object(h.a)("margin-top",T,f)},function(l){var f=l.theme,T=l.marginBottom;return Object(h.a)("margin-bottom",T,f)},function(l){var f=l.theme;return l.hiddenS?"".concat(f.mediaQueries.tablet," { display: none; }"):void 0},function(l){var f=l.theme;return l.hiddenXS?"".concat(f.mediaQueries.mobile," { display: none; }"):void 0},function(l){var f=l.theme,T=l.hasRadius,Q=l.borderRadius;return T?f.borderRadius:Q},function(l){return l.borderStyle},function(l){return l.borderWidth},function(l){var f=l.borderColor;return l.theme.colors[f]},function(l){var f=l.theme,T=l.borderColor,Q=l.borderStyle,X=l.borderWidth;if(T&&!Q&&!X)return"1px solid ".concat(f.colors[T])},function(l){var f=l.theme,T=l.shadow;return f.shadows[T]},function(l){return l.pointerEvents},function(l){var f=l._hover,T=l.theme;return f?f(T):void 0},function(l){return l.display},function(l){return l.position},function(l){var f=l.left;return l.theme.spaces[f]||f},function(l){var f=l.right;return l.theme.spaces[f]||f},function(l){var f=l.top;return l.theme.spaces[f]||f},function(l){var f=l.bottom;return l.theme.spaces[f]||f},function(l){return l.zIndex},function(l){return l.overflow},function(l){return l.cursor},function(l){var f=l.width;return l.theme.spaces[f]||f},function(l){var f=l.maxWidth;return l.theme.spaces[f]||f},function(l){var f=l.minWidth;return l.theme.spaces[f]||f},function(l){var f=l.height;return l.theme.spaces[f]||f},function(l){var f=l.maxHeight;return l.theme.spaces[f]||f},function(l){var f=l.minHeight;return l.theme.spaces[f]||f},function(l){return l.transition},function(l){return l.transform},function(l){return l.animation},function(l){return l.shrink},function(l){return l.grow},function(l){return l.basis},function(l){return l.flex},function(l){return l.textAlign},function(l){return l.textTransform},function(l){return l.lineHeight},function(l){return l.cursor});k.defaultProps=_,k.propTypes=M},7:function(s,u,o){"use strict";var a=o(10),i=o.n(a),m=o(13),p=o.n(m);u.a=function(O,h,C){var L=h;if(Array.isArray(h)||p()(h)!=="object"||(L=[h==null?void 0:h.desktop,h==null?void 0:h.tablet,h==null?void 0:h.mobile]),L!==void 0){if(Array.isArray(L)){var B=L,v=i()(B,3),S=v[0],_=v[1],M=v[2],G="".concat(O,": ").concat(C.spaces[S],";");return _!==void 0&&(G+="".concat(C.mediaQueries.tablet,`{
          `).concat(O,": ").concat(C.spaces[_],`;
        }`)),M!==void 0&&(G+="".concat(C.mediaQueries.mobile,`{
          `).concat(O,": ").concat(C.spaces[M],`;
        }`)),G}var k=C.spaces[L]||L;return"".concat(O,": ").concat(k,";")}}}})})},68717:function(A,j,c){(function(n,x){A.exports=x(c(67294))})(this,function(n){return function(x){var s={};function u(o){if(s[o])return s[o].exports;var a=s[o]={i:o,l:!1,exports:{}};return x[o].call(a.exports,a,a.exports,u),a.l=!0,a.exports}return u.m=x,u.c=s,u.d=function(o,a,i){u.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:i})},u.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},u.t=function(o,a){if(1&a&&(o=u(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var i=Object.create(null);if(u.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var m in o)u.d(i,m,function(p){return o[p]}.bind(null,m));return i},u.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return u.d(a,"a",a),a},u.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},u.p="",u(u.s=5)}({0:function(x,s){x.exports=n},5:function(x,s,u){"use strict";u.r(s);var o=u(0);function a(){return(a=Object.assign||function(i){for(var m=1;m<arguments.length;m++){var p=arguments[m];for(var O in p)Object.prototype.hasOwnProperty.call(p,O)&&(i[O]=p[O])}return i}).apply(this,arguments)}s.default=function(i){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i),o.createElement("path",{d:"M24 13.3a.2.2 0 01-.2.2H5.74l8.239 8.239a.2.2 0 010 .282L12.14 23.86a.2.2 0 01-.282 0L.14 12.14a.2.2 0 010-.282L11.86.14a.2.2 0 01.282 0L13.98 1.98a.2.2 0 010 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6z",fill:"#212134"}))}}})})},70736:function(A,j,c){(function(n,x){A.exports=x(c(67294))})(this,function(n){return function(x){var s={};function u(o){if(s[o])return s[o].exports;var a=s[o]={i:o,l:!1,exports:{}};return x[o].call(a.exports,a,a.exports,u),a.l=!0,a.exports}return u.m=x,u.c=s,u.d=function(o,a,i){u.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:i})},u.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},u.t=function(o,a){if(1&a&&(o=u(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var i=Object.create(null);if(u.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var m in o)u.d(i,m,function(p){return o[p]}.bind(null,m));return i},u.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return u.d(a,"a",a),a},u.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},u.p="",u(u.s=35)}({0:function(x,s){x.exports=n},35:function(x,s,u){"use strict";u.r(s);var o=u(0);function a(){return(a=Object.assign||function(i){for(var m=1;m<arguments.length;m++){var p=arguments[m];for(var O in p)Object.prototype.hasOwnProperty.call(p,O)&&(i[O]=p[O])}return i}).apply(this,arguments)}s.default=function(i){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i),o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.68 9.192c-.6.276-2.114 1.18-2.306 1.303a.792.792 0 00-.374.68v1.65a.797.797 0 00.384.687c.254.16 1.73 1.042 2.306 1.303l.744 1.8c-.24.634-.67 2.333-.72 2.554a.797.797 0 00.216.744l1.167 1.166a.801.801 0 00.744.216l.03-.008c.36-.092 1.946-.498 2.523-.712l1.8.744c.276.6 1.181 2.115 1.304 2.307a.805.805 0 00.679.374h1.649a.797.797 0 00.686-.384c.16-.254 1.042-1.73 1.303-2.306l1.8-.744c.634.24 2.333.67 2.554.72a.797.797 0 00.744-.216l1.166-1.167a.803.803 0 00.216-.744l-.008-.03c-.092-.36-.498-1.946-.712-2.523l.744-1.8c.6-.276 2.115-1.181 2.307-1.304a.804.804 0 00.374-.679v-1.649a.796.796 0 00-.382-.679c-.254-.16-1.73-1.041-2.306-1.303l-.744-1.8c.24-.634.67-2.333.72-2.554a.796.796 0 00-.216-.744l-1.166-1.173a.802.802 0 00-.744-.216l-.03.008c-.361.092-1.947.498-2.524.712l-1.8-.744c-.276-.6-1.18-2.115-1.303-2.307a.803.803 0 00-.68-.374h-1.65a.797.797 0 00-.68.382c-.16.254-1.041 1.73-1.303 2.306l-1.8.744c-.634-.24-2.333-.67-2.554-.72a.797.797 0 00-.744.216L2.921 4.094a.802.802 0 00-.216.744l.008.03c.092.361.498 1.947.712 2.524l-.744 1.8zM12 17a5 5 0 100-10 5 5 0 000 10z",fill:"#212134"}))}}})})},16098:(A,j,c)=>{"use strict";c.r(j),c.d(j,{default:()=>Tn});var n=c(67294),x=c(49656),s=c(68547),u=c(31498),o=c(81912),a=c(19408),i=c(78862),m=c(62031),p=c(41798),O=c(26851),h=c(49425),C=c(84686),L=c(80768),B=c.n(L),v=c(97132),S=c(23724),_=c(63852),M=c(89031),G=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const k=(r,e)=>G(void 0,null,function*(){try{const{data:t}=yield M.be.get((0,M.Gc)("roles"));return e("The roles have loaded successfully"),t}catch(t){throw r({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),l=(r,e)=>G(void 0,null,function*(){try{yield M.be.delete(`${(0,M.Gc)("roles")}/${r}`)}catch(t){e({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}});var f=c(45697),T=c.n(f),Q=c(30741),X=c(67826),H=c(19352),q=c.n(H),oe=c(18568),se=c.n(oe),st=Object.defineProperty,de=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,pe=(r,e,t)=>e in r?st(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,me=(r,e)=>{for(var t in e||(e={}))at.call(e,t)&&pe(r,t,e[t]);if(de)for(var t of de(e))it.call(e,t)&&pe(r,t,e[t]);return r};const ae=({sortedRoles:r,canDelete:e,permissions:t,setRoleToDelete:y,onDelete:b})=>{const{formatMessage:P}=(0,v.useIntl)(),{push:R}=(0,x.useHistory)(),[g,d]=b,E=w=>e&&!["public","authenticated"].includes(w.type),D=w=>{y(w),d(!g)},U=w=>{R(`/settings/${u.Z}/roles/${w}`)};return n.createElement(p.Tbody,null,r==null?void 0:r.map(w=>n.createElement(p.Tr,me({key:w.name},(0,s.onRowClick)({fn:()=>U(w.id)})),n.createElement(p.Td,{width:"20%"},n.createElement(h.Typography,null,w.name)),n.createElement(p.Td,{width:"50%"},n.createElement(h.Typography,null,w.description)),n.createElement(p.Td,{width:"30%"},n.createElement(h.Typography,null,`${w.nb_users} ${P({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),n.createElement(p.Td,null,n.createElement(X.Flex,me({justifyContent:"end"},s.stopPropagation),n.createElement(s.CheckPermissions,{permissions:t.updateRole},n.createElement(Q.IconButton,{onClick:()=>U(w.id),noBorder:!0,icon:n.createElement(q(),null),label:P({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${w.name}`})})),E(w)&&n.createElement(s.CheckPermissions,{permissions:t.deleteRole},n.createElement(Q.IconButton,{onClick:()=>D(w.id),noBorder:!0,icon:n.createElement(se(),null),label:P({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${w.name}`})})))))))},lt=ae;ae.defaultProps={canDelete:!1},ae.propTypes={onDelete:T().array.isRequired,permissions:T().object.isRequired,setRoleToDelete:T().func.isRequired,sortedRoles:T().array.isRequired,canDelete:T().bool};var fe=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const ct=()=>{const{trackUsage:r}=(0,s.useTracking)(),{formatMessage:e}=(0,v.useIntl)(),{push:t}=(0,x.useHistory)(),y=(0,s.useNotification)(),{notifyStatus:b}=(0,C.useNotifyAT)(),[{query:P}]=(0,s.useQueryParams)(),R=(P==null?void 0:P._q)||"",[g,d]=(0,n.useState)(!1),[E,D]=(0,n.useState)(!1),[U,w]=(0,n.useState)();(0,s.useFocusWhenNavigate)();const N=(0,S.useQueryClient)(),I=(0,n.useMemo)(()=>({create:o.Z.createRole,read:o.Z.readRoles,update:o.Z.updateRole,delete:o.Z.deleteRole}),[]),{isLoading:$,allowedActions:{canRead:V,canDelete:J}}=(0,s.useRBAC)(I),{isLoading:Cn,data:{roles:ue},isFetching:wn}=(0,S.useQuery)("get-roles",()=>k(y,b),{initialData:{},enabled:V}),ot=Cn||wn,Sn=()=>{r("willCreateRole"),t(`/settings/${u.Z}/roles/new`)},An=()=>{d(!g)},Dn={roles:{id:(0,M.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,M.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Ln=e({id:"global.roles",defaultMessage:"Roles"}),jn=(0,S.useMutation)(In=>l(In,y),{onSuccess(){return fe(this,null,function*(){yield N.invalidateQueries("get-roles")})}}),Mn=()=>fe(void 0,null,function*(){D(!0),yield jn.mutateAsync(U),d(!g),D(!1)}),ee=(0,_.ZP)(ue||[],R,{keys:["name","description"]}),_n=R&&!ee.length?"search":"roles",Un=4,Bn=((ue==null?void 0:ue.length)||0)+1;return n.createElement(i.Layout,null,n.createElement(s.SettingsPageTitle,{name:Ln}),n.createElement(m.Main,{"aria-busy":ot},n.createElement(i.HeaderLayout,{title:e({id:"global.roles",defaultMessage:"Roles"}),subtitle:e({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:n.createElement(s.CheckPermissions,{permissions:o.Z.createRole},n.createElement(a.Button,{onClick:Sn,startIcon:n.createElement(B(),null),size:"L"},e({id:(0,M.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),n.createElement(i.ActionLayout,{startActions:n.createElement(s.SearchURLQuery,{label:e({id:"app.component.search.label",defaultMessage:"Search"})})}),n.createElement(i.ContentLayout,null,!V&&n.createElement(s.NoPermissions,null),(ot||$)&&n.createElement(s.LoadingIndicatorPage,null),V&&ee&&(ee==null?void 0:ee.length)?n.createElement(p.Table,{colCount:Un,rowCount:Bn},n.createElement(p.Thead,null,n.createElement(p.Tr,null,n.createElement(p.Th,null,n.createElement(h.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.name",defaultMessage:"Name"}))),n.createElement(p.Th,null,n.createElement(h.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.description",defaultMessage:"Description"}))),n.createElement(p.Th,null,n.createElement(h.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.users",defaultMessage:"Users"}))),n.createElement(p.Th,null,n.createElement(O.VisuallyHidden,null,e({id:"global.actions",defaultMessage:"Actions"}))))),n.createElement(lt,{sortedRoles:ee,canDelete:J,permissions:o.Z,setRoleToDelete:w,onDelete:[g,d]})):n.createElement(s.EmptyStateLayout,{content:Dn[_n]})),n.createElement(s.ConfirmDialog,{isConfirmButtonLoading:E,onConfirm:Mn,onToggleDialog:An,isOpen:g})))},ut=()=>n.createElement(s.CheckPagePermissions,{permissions:o.Z.accessRoles},n.createElement(ct,null));var ge=c(80831),F=c(9008),W=c(5493),ve=c(55967),ye=c(59626),dt=c(68717),pt=c.n(dt),mt=c(84734),he=c.n(mt),Z=c(34626),K=c(84757),z=c(96486);const Pe=(0,n.createContext)({}),Ee=({children:r,value:e})=>n.createElement(Pe.Provider,{value:e},r),ie=()=>(0,n.useContext)(Pe);Ee.propTypes={children:T().node.isRequired,value:T().object.isRequired};var te=c(78384),ft=c(35161),gt=c.n(ft),vt=c(13217),yt=c.n(vt);const ht=r=>{switch(r){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Pt=(0,te.default)(W.Box)`
  margin: -1px;
  border-radius: ${({theme:r})=>r.spaces[1]} 0 0 ${({theme:r})=>r.spaces[1]};
`;function le({route:r}){const{formatMessage:e}=(0,v.useIntl)(),{method:t,handler:y,path:b}=r,P=b?yt()(b.split("/")):[],[R="",g=""]=y?y.split("."):[],d=ht(r.method);return n.createElement(F.Stack,{spacing:2},n.createElement(h.Typography,{variant:"delta",as:"h3"},e({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",n.createElement("span",null,R),n.createElement(h.Typography,{variant:"delta",textColor:"primary600"},".",g)),n.createElement(F.Stack,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},n.createElement(Pt,{background:d.background,borderColor:d.border,padding:2},n.createElement(h.Typography,{fontWeight:"bold",textColor:d.text},t)),n.createElement(W.Box,{paddingLeft:2,paddingRight:2},gt()(P,E=>n.createElement(h.Typography,{key:E,textColor:E.includes(":")?"neutral600":"neutral900"},"/",E)))))}le.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},le.propTypes={route:T().shape({handler:T().string,method:T().string,path:T().string})};const Et=le,bt=()=>{const{formatMessage:r}=(0,v.useIntl)(),{selectedAction:e,routes:t}=ie(),y=(0,z.without)(e.split("."),"controllers"),b=(0,z.get)(t,y[0]),P=y.slice(1).join("."),R=(0,z.isEmpty)(b)?[]:b.filter(g=>g.handler.endsWith(P));return n.createElement(Z.GridItem,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},e?n.createElement(F.Stack,{spacing:2},R.map((g,d)=>n.createElement(Et,{key:d,route:g}))):n.createElement(F.Stack,{spacing:2},n.createElement(h.Typography,{variant:"delta",as:"h3"},r({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),n.createElement(h.Typography,{as:"p",textColor:"neutral600"},r({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var ce=c(96654),Ot=c(11700),Rt=c.n(Ot);function xt(r){switch(r){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Rt()(r.replace("api::","").replace("plugin::",""))}}const Tt=xt;var Ct=c(89734),be=c.n(Ct),Oe=c(81325),wt=c(70736),St=c.n(wt);const Re=te.css`
  background: ${r=>r.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,At=(0,te.default)(W.Box)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${r=>r.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${r=>r.isActive&&Re}
  &:hover {
    ${Re}
  }
`,Dt=te.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:r})=>r.colors.neutral150};
`,xe=({subCategory:r})=>{const{formatMessage:e}=(0,v.useIntl)(),{onChange:t,onChangeSelectAll:y,onSelectedAction:b,selectedAction:P,modifiedData:R}=ie(),g=(0,n.useMemo)(()=>(0,z.get)(R,r.name,{}),[R,r]),d=(0,n.useMemo)(()=>Object.values(g).every(w=>w.enabled===!0),[g]),E=(0,n.useMemo)(()=>Object.values(g).some(w=>w.enabled===!0)&&!d,[g,d]),D=(0,n.useCallback)(({target:{name:w}})=>{y({target:{name:w,value:!d}})},[d,y]),U=(0,n.useCallback)(w=>P===w,[P]);return n.createElement(W.Box,null,n.createElement(X.Flex,{justifyContent:"space-between",alignItems:"center"},n.createElement(W.Box,{paddingRight:4},n.createElement(h.Typography,{variant:"sigma",textColor:"neutral600"},r.label)),n.createElement(Dt,null),n.createElement(W.Box,{paddingLeft:4},n.createElement(Oe.Checkbox,{name:r.name,value:d,onValueChange:w=>D({target:{name:r.name,value:w}}),indeterminate:E},e({id:"app.utils.select-all",defaultMessage:"Select all"})))),n.createElement(X.Flex,{paddingTop:6,paddingBottom:6},n.createElement(Z.Grid,{gap:2,style:{flex:1}},r.actions.map(w=>{const N=`${w.name}.enabled`;return n.createElement(Z.GridItem,{col:6,key:w.name},n.createElement(At,{isActive:U(w.name),padding:2,hasRadius:!0},n.createElement(Oe.Checkbox,{value:(0,z.get)(R,N,!1),name:N,onValueChange:I=>t({target:{name:N,value:I}})},w.label),n.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>b(w.name),style:{display:"inline-flex",alignItems:"center"}},n.createElement(St(),null))))}))))};xe.propTypes={subCategory:T().object.isRequired};const Lt=xe;var jt=Object.defineProperty,Mt=Object.defineProperties,_t=Object.getOwnPropertyDescriptors,Te=Object.getOwnPropertySymbols,Ut=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable,Ce=(r,e,t)=>e in r?jt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,It=(r,e)=>{for(var t in e||(e={}))Ut.call(e,t)&&Ce(r,t,e[t]);if(Te)for(var t of Te(e))Bt.call(e,t)&&Ce(r,t,e[t]);return r},Nt=(r,e)=>Mt(r,_t(e));const we=({name:r,permissions:e})=>{const t=(0,n.useMemo)(()=>be()(Object.values(e.controllers).reduce((y,b,P)=>{const R=`${r}.controllers.${Object.keys(e.controllers)[P]}`,g=be()(Object.keys(b).reduce((d,E)=>[...d,Nt(It({},b[E]),{label:E,name:`${R}.${E}`})],[]),"label");return[...y,{actions:g,label:Object.keys(e.controllers)[P],name:R}]},[]),"label"),[r,e]);return n.createElement(W.Box,{padding:6},t.map(y=>n.createElement(Lt,{key:y.name,subCategory:y})))};we.propTypes={name:T().string.isRequired,permissions:T().object.isRequired};const Gt=we;var kt=Object.defineProperty,Ft=Object.defineProperties,Zt=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,$t=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,Ae=(r,e,t)=>e in r?kt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ht=(r,e)=>{for(var t in e||(e={}))$t.call(e,t)&&Ae(r,t,e[t]);if(Se)for(var t of Se(e))Vt.call(e,t)&&Ae(r,t,e[t]);return r},Wt=(r,e)=>Ft(r,Zt(e));const zt=(r,e)=>{const t=Object.keys(e).sort().map(y=>({name:y,isOpen:!1}));return Wt(Ht({},r),{collapses:t})};var re=c(8041),Qt=Object.defineProperty,Xt=Object.defineProperties,Kt=Object.getOwnPropertyDescriptors,De=Object.getOwnPropertySymbols,Yt=Object.prototype.hasOwnProperty,Jt=Object.prototype.propertyIsEnumerable,Le=(r,e,t)=>e in r?Qt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,je=(r,e)=>{for(var t in e||(e={}))Yt.call(e,t)&&Le(r,t,e[t]);if(De)for(var t of De(e))Jt.call(e,t)&&Le(r,t,e[t]);return r},Me=(r,e)=>Xt(r,Kt(e));const qt={collapses:[]},er=(r,e)=>(0,re.default)(r,t=>{switch(e.type){case"TOGGLE_COLLAPSE":{t.collapses=r.collapses.map((y,b)=>b===e.index?Me(je({},y),{isOpen:!y.isOpen}):Me(je({},y),{isOpen:!1}));break}default:return t}}),tr=()=>{const{modifiedData:r}=ie(),{formatMessage:e}=(0,v.useIntl)(),[{collapses:t},y]=(0,n.useReducer)(er,qt,P=>zt(P,r)),b=P=>y({type:"TOGGLE_COLLAPSE",index:P});return n.createElement(F.Stack,{spacing:1},t.map((P,R)=>n.createElement(ce.Accordion,{expanded:P.isOpen,onToggle:()=>b(R),key:P.name,variant:R%2===0?"secondary":void 0},n.createElement(ce.AccordionToggle,{title:Tt(P.name),description:e({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:P.name}),variant:R%2?"primary":"secondary"}),n.createElement(ce.AccordionContent,null,n.createElement(W.Box,null,n.createElement(Gt,{permissions:r[P.name],name:P.name}))))))};var rr=Object.defineProperty,nr=Object.defineProperties,or=Object.getOwnPropertyDescriptors,_e=Object.getOwnPropertySymbols,sr=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable,Ue=(r,e,t)=>e in r?rr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ir=(r,e)=>{for(var t in e||(e={}))sr.call(e,t)&&Ue(r,t,e[t]);if(_e)for(var t of _e(e))ar.call(e,t)&&Ue(r,t,e[t]);return r},lr=(r,e)=>nr(r,or(e));const cr={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ur=(r,e)=>(0,re.default)(r,t=>{switch(e.type){case"ON_CHANGE":{const y=e.keys.length,b=e.keys[y-1]==="enabled";if(e.value&&b){const P=(0,z.take)(e.keys,y-1).join(".");t.selectedAction=P}(0,z.set)(t,["modifiedData",...e.keys],e.value);break}case"ON_CHANGE_SELECT_ALL":{const y=["modifiedData",...e.keys],b=(0,z.get)(r,y,{}),P=Object.keys(b).reduce((R,g)=>(R[g]=lr(ir({},b[g]),{enabled:e.value}),R),{});(0,z.set)(t,y,P);break}case"ON_RESET":{t.modifiedData=r.initialData;break}case"ON_SUBMIT_SUCCEEDED":{t.initialData=r.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:y}=e;t.selectedAction=y===r.selectedAction?"":y;break}default:return t}});var dr=Object.defineProperty,pr=Object.defineProperties,mr=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,fr=Object.prototype.hasOwnProperty,gr=Object.prototype.propertyIsEnumerable,Ie=(r,e,t)=>e in r?dr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vr=(r,e)=>{for(var t in e||(e={}))fr.call(e,t)&&Ie(r,t,e[t]);if(Be)for(var t of Be(e))gr.call(e,t)&&Ie(r,t,e[t]);return r},yr=(r,e)=>pr(r,mr(e));const hr=(r,e,t)=>yr(vr({},r),{initialData:e,modifiedData:e,routes:t});var Pr=Object.defineProperty,Er=Object.defineProperties,br=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Or=Object.prototype.hasOwnProperty,Rr=Object.prototype.propertyIsEnumerable,Ge=(r,e,t)=>e in r?Pr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xr=(r,e)=>{for(var t in e||(e={}))Or.call(e,t)&&Ge(r,t,e[t]);if(Ne)for(var t of Ne(e))Rr.call(e,t)&&Ge(r,t,e[t]);return r},Tr=(r,e)=>Er(r,br(e));const ke=(0,n.forwardRef)(({permissions:r,routes:e},t)=>{const{formatMessage:y}=(0,v.useIntl)(),[b,P]=(0,n.useReducer)(ur,cr,D=>hr(D,r,e));(0,n.useImperativeHandle)(t,()=>({getPermissions(){return{permissions:b.modifiedData}},resetForm(){P({type:"ON_RESET"})},setFormAfterSubmit(){P({type:"ON_SUBMIT_SUCCEEDED"})}}));const R=({target:{name:D,value:U}})=>P({type:"ON_CHANGE",keys:D.split("."),value:U==="empty__string_value"?"":U}),g=({target:{name:D,value:U}})=>P({type:"ON_CHANGE_SELECT_ALL",keys:D.split("."),value:U}),d=D=>P({type:"SELECT_ACTION",actionToSelect:D}),E=Tr(xr({},b),{onChange:R,onChangeSelectAll:g,onSelectedAction:d});return n.createElement(Ee,{value:E},n.createElement(Z.Grid,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},n.createElement(Z.GridItem,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},n.createElement(F.Stack,{spacing:6},n.createElement(F.Stack,{spacing:2},n.createElement(h.Typography,{variant:"delta",as:"h2"},y({id:(0,K.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),n.createElement(h.Typography,{as:"p",textColor:"neutral600"},y({id:(0,K.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),n.createElement(tr,null))),n.createElement(bt,null)))});ke.propTypes={permissions:T().object.isRequired,routes:T().object.isRequired};const Fe=(0,n.memo)(ke),zn={isLoading:!0,modifiedData:{}},Qn=(r,e)=>produce(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.modifiedData={};break}case"GET_DATA_SUCCEEDED":{t.isLoading=!1,t.modifiedData=e.data;break}case"GET_DATA_ERROR":{t.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{t.modifiedData=e.data;break}default:return t}}),Xn=null;var Cr=c(25108),wr=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const Kn=(r,e)=>{const{isLoading:t,allowedActions:y}=useRBAC(e),[{isLoading:b,modifiedData:P},R]=useReducer(reducer,initialState),g=useNotification(),d=useRef(!0),E=new AbortController,{signal:D}=E;useEffect(()=>(t||(()=>wr(void 0,null,function*(){try{R({type:"GET_DATA"});const N=yield request(getRequestURL(r),{method:"GET",signal:D});R({type:"GET_DATA_SUCCEEDED",data:N})}catch(N){d.current&&(R({type:"GET_DATA_ERROR"}),Cr.error(N),g({type:"warning",message:{id:"notification.error"}}))}}))(),()=>{E.abort(),d.current=!1}),[t,r]);const U=useCallback(w=>{R({type:"ON_SUBMIT_SUCCEEDED",data:w})},[]);return{allowedActions:y,dispatchSubmitSucceeded:U,isLoading:b,isLoadingForPermissions:t,modifiedData:P}},Yn=null;var Sr=Object.defineProperty,Ar=Object.defineProperties,Dr=Object.getOwnPropertyDescriptors,Ze=Object.getOwnPropertySymbols,Lr=Object.prototype.hasOwnProperty,jr=Object.prototype.propertyIsEnumerable,$e=(r,e,t)=>e in r?Sr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e)=>{for(var t in e||(e={}))Lr.call(e,t)&&$e(r,t,e[t]);if(Ze)for(var t of Ze(e))jr.call(e,t)&&$e(r,t,e[t]);return r},_r=(r,e)=>Ar(r,Dr(e));const Jn=(r,e)=>_r(Mr({},r),{isLoading:e}),qn=null,eo={roles:[],isLoading:!0},to=(r,e)=>produce(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.roles=[];break}case"GET_DATA_SUCCEEDED":{t.roles=e.data,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}}),ro=null;var Ur=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const no=(r=!0)=>{const[{roles:e,isLoading:t},y]=useReducer(reducer,initialState,()=>init(initialState,r)),b=useNotification(),P=useRef(!0),R=new AbortController,{signal:g}=R;useEffect(()=>(r&&d(),()=>{R.abort(),P.current=!1}),[r]);const d=()=>Ur(void 0,null,function*(){try{y({type:"GET_DATA"});const{roles:E}=yield request(`/${pluginId}/roles`,{method:"GET",signal:g});y({type:"GET_DATA_SUCCEEDED",data:E})}catch(E){const D=get(E,["response","payload","message"],"An error occured");P.current&&(y({type:"GET_DATA_ERROR"}),D!=="Forbidden"&&b({type:"warning",message:D}))}});return{roles:e,isLoading:t,getData:d}},oo=null;var Br=Object.defineProperty,Ir=Object.defineProperties,Nr=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertySymbols,Gr=Object.prototype.hasOwnProperty,kr=Object.prototype.propertyIsEnumerable,He=(r,e,t)=>e in r?Br(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fr=(r,e)=>{for(var t in e||(e={}))Gr.call(e,t)&&He(r,t,e[t]);if(Ve)for(var t of Ve(e))kr.call(e,t)&&He(r,t,e[t]);return r},Zr=(r,e)=>Ir(r,Nr(e));const $r=(r,e)=>Zr(Fr({},r),{isLoading:e});var ne=c(46979);const We={permissions:{},routes:{},isLoading:!0},Vr=(r,e)=>(0,re.default)(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.permissions={},t.routes={};break}case"GET_DATA_SUCCEEDED":{t.permissions=e.permissions,t.routes=e.routes,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}});var ze=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const Qe=(r=!0)=>{const e=(0,s.useNotification)(),[{permissions:t,routes:y,isLoading:b},P]=(0,n.useReducer)(Vr,We,()=>$r(We,r)),R=(0,n.useCallback)(()=>ze(void 0,null,function*(){try{P({type:"GET_DATA"});const[{permissions:g},{routes:d}]=yield Promise.all([`/${u.Z}/permissions`,`/${u.Z}/routes`].map(E=>ze(void 0,null,function*(){return(yield ne.Z.get(E)).data})));P({type:"GET_DATA_SUCCEEDED",permissions:(0,M.YX)(g),routes:d})}catch(g){const d=(0,z.get)(g,["response","payload","message"],"An error occured");P({type:"GET_DATA_ERROR"}),d!=="Forbidden"&&e({type:"warning",message:d})}}),[e]);return(0,n.useEffect)(()=>{r&&R()},[R,r]),{permissions:t,routes:y,getData:R,isLoading:b}},Hr={role:{},isLoading:!0},Wr=(r,e)=>(0,re.default)(r,t=>{switch(e.type){case"GET_DATA_SUCCEEDED":{t.role=e.role,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{t.role.name=e.name,t.role.description=e.description;break}default:return t}});var zr=c(25108),Qr=Object.defineProperty,Xr=Object.defineProperties,Kr=Object.getOwnPropertyDescriptors,Xe=Object.getOwnPropertySymbols,Yr=Object.prototype.hasOwnProperty,Jr=Object.prototype.propertyIsEnumerable,Ke=(r,e,t)=>e in r?Qr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ye=(r,e)=>{for(var t in e||(e={}))Yr.call(e,t)&&Ke(r,t,e[t]);if(Xe)for(var t of Xe(e))Jr.call(e,t)&&Ke(r,t,e[t]);return r},qr=(r,e)=>Xr(r,Kr(e)),en=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const tn=r=>{const[e,t]=(0,n.useReducer)(Wr,Hr),y=(0,s.useNotification)(),b=(0,n.useRef)(null);(0,n.useEffect)(()=>(b.current=!0,r?P(r):t({type:"GET_DATA_SUCCEEDED",role:{}}),()=>b.current=!1),[r]);const P=g=>en(void 0,null,function*(){try{const{data:{role:d}}=yield ne.Z.get(`/${u.Z}/roles/${g}`);b.current&&t({type:"GET_DATA_SUCCEEDED",role:d})}catch(d){zr.error(d),t({type:"GET_DATA_ERROR"}),y({type:"warning",message:{id:"notification.error"}})}}),R=(0,n.useCallback)(g=>{t(Ye({type:"ON_SUBMIT_SUCCEEDED"},g))},[]);return qr(Ye({},e),{onSubmitSucceeded:R})};var Y=c(53209);const rn=Y.Ry().shape({name:Y.Z_().required(s.translatedErrors.required),description:Y.Z_().required(s.translatedErrors.required)});var nn=c(25108),on=Object.defineProperty,sn=Object.defineProperties,an=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,ln=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable,qe=(r,e,t)=>e in r?on(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,et=(r,e)=>{for(var t in e||(e={}))ln.call(e,t)&&qe(r,t,e[t]);if(Je)for(var t of Je(e))cn.call(e,t)&&qe(r,t,e[t]);return r},un=(r,e)=>sn(r,an(e)),dn=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const pn=()=>{const{formatMessage:r}=(0,v.useIntl)(),[e,t]=(0,n.useState)(!1),y=(0,s.useNotification)(),{lockApp:b,unlockApp:P}=(0,s.useOverlayBlocker)(),{params:{id:R}}=(0,x.useRouteMatch)(`/settings/${u.Z}/roles/:id`),{isLoading:g,routes:d}=Qe(),{role:E,onSubmitSucceeded:D,isLoading:U}=tn(R),w=(0,n.useRef)(),N=I=>dn(void 0,null,function*(){b(),t(!0);try{const $=w.current.getPermissions();yield ne.Z.put(`/${u.Z}/roles/${R}`,un(et(et({},I),$),{users:[]})),D({name:I.name,description:I.description}),y({type:"success",message:{id:(0,K.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch($){nn.error($),y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),P()});return U?n.createElement(s.LoadingIndicatorPage,null):n.createElement(m.Main,null,n.createElement(s.SettingsPageTitle,{name:"Roles"}),n.createElement(ge.Formik,{enableReinitialize:!0,initialValues:{name:E.name,description:E.description},onSubmit:N,validationSchema:rn},({handleSubmit:I,values:$,handleChange:V,errors:J})=>n.createElement(s.Form,{noValidate:!0,onSubmit:I},n.createElement(i.HeaderLayout,{primaryAction:!g&&n.createElement(a.Button,{disabled:E.code==="strapi-super-admin",type:"submit",loading:e,startIcon:n.createElement(he(),null)},r({id:"global.save",defaultMessage:"Save"})),title:E.name,subtitle:E.description,navigationAction:n.createElement(s.Link,{startIcon:n.createElement(pt(),null),to:"/settings/users-permissions/roles"},r({id:"global.back",defaultMessage:"Back"}))}),n.createElement(i.ContentLayout,null,n.createElement(F.Stack,{spacing:7},n.createElement(W.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},n.createElement(F.Stack,{spacing:4},n.createElement(h.Typography,{variant:"delta",as:"h2"},r({id:(0,K.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),n.createElement(Z.Grid,{gap:4},n.createElement(Z.GridItem,{col:6},n.createElement(ve.TextInput,{name:"name",value:$.name||"",onChange:V,label:r({id:"global.name",defaultMessage:"Name"}),error:J.name?r({id:J.name,defaultMessage:"Invalid value"}):null})),n.createElement(Z.GridItem,{col:6},n.createElement(ye.Textarea,{name:"description",value:$.description||"",onChange:V,label:r({id:"global.description",defaultMessage:"Description"}),error:J.description?r({id:J.description,defaultMessage:"Invalid value"}):null}))))),!g&&n.createElement(Fe,{ref:w,permissions:E.permissions,routes:d}))))))},mn=()=>n.createElement(s.CheckPagePermissions,{permissions:o.Z.updateRole},n.createElement(pn,null)),fn=Y.Ry().shape({name:Y.Z_().required(s.translatedErrors.required),description:Y.Z_().required(s.translatedErrors.required)});var gn=c(25108),vn=Object.defineProperty,yn=Object.defineProperties,hn=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,Pn=Object.prototype.hasOwnProperty,En=Object.prototype.propertyIsEnumerable,rt=(r,e,t)=>e in r?vn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nt=(r,e)=>{for(var t in e||(e={}))Pn.call(e,t)&&rt(r,t,e[t]);if(tt)for(var t of tt(e))En.call(e,t)&&rt(r,t,e[t]);return r},bn=(r,e)=>yn(r,hn(e)),On=(r,e,t)=>new Promise((y,b)=>{var P=d=>{try{g(t.next(d))}catch(E){b(E)}},R=d=>{try{g(t.throw(d))}catch(E){b(E)}},g=d=>d.done?y(d.value):Promise.resolve(d.value).then(P,R);g((t=t.apply(r,e)).next())});const Rn=()=>{const{formatMessage:r}=(0,v.useIntl)(),[e,t]=(0,n.useState)(!1),y=(0,s.useNotification)(),{goBack:b}=(0,x.useHistory)(),{lockApp:P,unlockApp:R}=(0,s.useOverlayBlocker)(),{isLoading:g,permissions:d,routes:E}=Qe(),{trackUsage:D}=(0,s.useTracking)(),U=(0,n.useRef)(),w=N=>On(void 0,null,function*(){P(),t(!0);try{const I=U.current.getPermissions();yield ne.Z.post(`/${u.Z}/roles`,bn(nt(nt({},N),I),{users:[]})),D("didCreateRole"),y({type:"success",message:{id:(0,K.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),b()}catch(I){gn.error(I),y({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),R()});return n.createElement(m.Main,null,n.createElement(s.SettingsPageTitle,{name:"Roles"}),n.createElement(ge.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:w,validationSchema:fn},({handleSubmit:N,values:I,handleChange:$,errors:V})=>n.createElement(s.Form,{noValidate:!0,onSubmit:N},n.createElement(i.HeaderLayout,{primaryAction:!g&&n.createElement(a.Button,{type:"submit",loading:e,startIcon:n.createElement(he(),null)},r({id:"global.save",defaultMessage:"Save"})),title:r({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:r({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),n.createElement(i.ContentLayout,null,n.createElement(F.Stack,{spacing:7},n.createElement(W.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},n.createElement(F.Stack,{spacing:4},n.createElement(h.Typography,{variant:"delta",as:"h2"},r({id:(0,K.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),n.createElement(Z.Grid,{gap:4},n.createElement(Z.GridItem,{col:6},n.createElement(ve.TextInput,{name:"name",value:I.name||"",onChange:$,label:r({id:"global.name",defaultMessage:"Name"}),error:V.name?r({id:V.name,defaultMessage:"Invalid value"}):null})),n.createElement(Z.GridItem,{col:6},n.createElement(ye.Textarea,{name:"description",value:I.description||"",onChange:$,label:r({id:"global.description",defaultMessage:"Description"}),error:V.description?r({id:V.description,defaultMessage:"Invalid value"}):null}))))),!g&&n.createElement(Fe,{ref:U,permissions:d,routes:E}))))))},xn=()=>n.createElement(s.CheckPagePermissions,{permissions:o.Z.createRole},n.createElement(Rn,null)),Tn=()=>n.createElement(s.CheckPagePermissions,{permissions:o.Z.accessRoles},n.createElement(x.Switch,null,n.createElement(x.Route,{path:`/settings/${u.Z}/roles/new`,component:xn,exact:!0}),n.createElement(x.Route,{path:`/settings/${u.Z}/roles/:id`,component:mn,exact:!0}),n.createElement(x.Route,{path:`/settings/${u.Z}/roles`,component:ut,exact:!0}),n.createElement(x.Route,{path:"",component:s.NotFound})))},46979:(A,j,c)=>{"use strict";c.d(j,{Z:()=>i});var n=c(9669),x=c.n(n),s=c(68547),u=c.n(s),o=(m,p,O)=>new Promise((h,C)=>{var L=S=>{try{v(O.next(S))}catch(_){C(_)}},B=S=>{try{v(O.throw(S))}catch(_){C(_)}},v=S=>S.done?h(S.value):Promise.resolve(S.value).then(L,B);v((O=O.apply(m,p)).next())});const a=x().create({baseURL:""});a.interceptors.request.use(m=>o(void 0,null,function*(){return m.headers={Authorization:`Bearer ${s.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},m}),m=>{Promise.reject(m)}),a.interceptors.response.use(m=>m,m=>{var p;throw((p=m.response)==null?void 0:p.status)===401&&(s.auth.clearAppStorage(),window.location.reload()),m});const i=a},89031:(A,j,c)=>{"use strict";c.d(j,{be:()=>n.Z,YX:()=>u,Gc:()=>i,OB:()=>m.Z});var n=c(46979),x=c(96486);const u=p=>Object.keys(p).reduce((O,h)=>{const C=p[h].controllers,L=Object.keys(C).reduce((B,v)=>((0,x.isEmpty)(C[v])||(B[v]=C[v]),B),{});return(0,x.isEmpty)(L)||(O[h]={controllers:L}),O},{});var o=c(31498);const i=p=>`/${o.Z}/${p}`;var m=c(84757)},89881:(A,j,c)=>{var n=c(47816),x=c(99291),s=x(n);A.exports=s},69199:(A,j,c)=>{var n=c(89881),x=c(98612);function s(u,o){var a=-1,i=x(u)?Array(u.length):[];return n(u,function(m,p,O){i[++a]=o(m,p,O)}),i}A.exports=s},82689:(A,j,c)=>{var n=c(29932),x=c(97786),s=c(67206),u=c(69199),o=c(71131),a=c(7518),i=c(85022),m=c(6557),p=c(1469);function O(h,C,L){C.length?C=n(C,function(S){return p(S)?function(_){return x(_,S.length===1?S[0]:S)}:S}):C=[m];var B=-1;C=n(C,a(s));var v=u(h,function(S,_,M){var G=n(C,function(k){return k(S)});return{criteria:G,index:++B,value:S}});return o(v,function(S,_){return i(S,_,L)})}A.exports=O},71131:A=>{function j(c,n){var x=c.length;for(c.sort(n);x--;)c[x]=c[x].value;return c}A.exports=j},26393:(A,j,c)=>{var n=c(33448);function x(s,u){if(s!==u){var o=s!==void 0,a=s===null,i=s===s,m=n(s),p=u!==void 0,O=u===null,h=u===u,C=n(u);if(!O&&!C&&!m&&s>u||m&&p&&h&&!O&&!C||a&&p&&h||!o&&h||!i)return 1;if(!a&&!m&&!C&&s<u||C&&o&&i&&!a&&!m||O&&o&&i||!p&&i||!h)return-1}return 0}A.exports=x},85022:(A,j,c)=>{var n=c(26393);function x(s,u,o){for(var a=-1,i=s.criteria,m=u.criteria,p=i.length,O=o.length;++a<p;){var h=n(i[a],m[a]);if(h){if(a>=O)return h;var C=o[a];return h*(C=="desc"?-1:1)}}return s.index-u.index}A.exports=x},99291:(A,j,c)=>{var n=c(98612);function x(s,u){return function(o,a){if(o==null)return o;if(!n(o))return s(o,a);for(var i=o.length,m=u?i:-1,p=Object(o);(u?m--:++m<i)&&a(p[m],m,p)!==!1;);return o}}A.exports=x},35161:(A,j,c)=>{var n=c(29932),x=c(67206),s=c(69199),u=c(1469);function o(a,i){var m=u(a)?n:s;return m(a,x(i,3))}A.exports=o},89734:(A,j,c)=>{var n=c(21078),x=c(82689),s=c(18460),u=c(16612),o=s(function(a,i){if(a==null)return[];var m=i.length;return m>1&&u(a,i[0],i[1])?i=[]:m>2&&u(i[0],i[1],i[2])&&(i=[i[0]]),x(a,n(i,1),[])});A.exports=o},13217:(A,j,c)=>{var n=c(14259);function x(s){var u=s==null?0:s.length;return u?n(s,1,u):[]}A.exports=x}}]);
